\chapter{测试与部署}

作为软件工程的要求，本项目将进行自动化的集成、测试与部署，共分为硬件，软件与文档三部分。所有的流程都将通过Docker进行，确保是可完整重现的。

\section{硬件部分}
\label{section:test_hardware}

本项目使用的主要硬件设计语言SystemVerilog是一门强大的验证语言，我们将使用其编写testbench来测试硬件模块。主要的testbench也分为三个模块：

\begin{description}
    \item[CPU测试] 本部分用于测试CPU实现指令的正确性。开发者为每一条实现的指令书写对应的汇编测试代码，通过编译器转换为内存映像COE格式，并得到预期的结果（寄存器变化）。测试程序读取内存映像，将自己作为指令内存与CPU交互并监视CPU的运行，在运行结果不符合预期时报错。
    \item[外设测试] 本部分用于测试外设控制器的实现正确性（主要是时序）。测试程序作为Master挂接于总线上，其余外设控制器作为Slave正常连接。测试程序向每个外设分别发出不同的读写指令，硬件部分使用对应的仿真模型文件，或者直接观察信号变化，在返回结果不符合预期，或向硬件发出的指令不正确时，终止运行并反馈错误。
    \item[完整测试] 本部分用于模拟整个片上系统的运行。测试时CPU、总线与各个外设控制器正常连接，SRAM、Flash与Bootrom的仿真模型中均配置所需的映像文件。启动测试后，可模拟从加载Bootloader到加载操作系统的全过程。
\end{description}

对于主分支的每一次提交，都需要进行持续集成，包括进行Vivado项目的编译、综合与进行上述的仿真。通常只运行CPU和外设测试部分，在需要时运行完整测试。

\section{软件部分}

在软件方面，本项目计划对编写的所有汇编/C/C++代码，移植的Bootloader、操作系统，以及需要运行的功能测试、性能测试，均编写持续集成脚本，保证每个版本都能进行正确的、可重现的编译。进一步地，借助计原在线平台提供的 ThinPad SDK，可以在上一步硬件部分编译完成bitstream的基础上，将硬件设计与软件一同上传运行，在检验硬件实现正确性的同时，也可以自动化地测试其性能表现。

\section{文档部分}

最后，作为需求文档的结尾，本文档已经实现了计划中的自动集成的功能。对任意文档的每一次修改都能自动编译成对应的版本发布到GitLab，方便开发人员与需求方的查阅。